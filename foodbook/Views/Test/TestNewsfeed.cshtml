@{
    ViewData["Title"] = "Test Newsfeed";
}

<div class="container mt-4">
    <h2>Test Newsfeed Loading</h2>
    <p>Current User ID: <strong>@(ViewBag.CurrentUserId ?? "Not logged in")</strong></p>

    <div class="row">
        <div class="col-md-6">
            <h3>Test LoadMoreRecipes (Original)</h3>
            <form method="get" action="@Url.Action("LoadMoreRecipes", "Home")">
                <div class="mb-3">
                    <label for="page" class="form-label">Page:</label>
                    <input type="number" class="form-control" id="page" name="page" value="1" min="1">
                </div>
                <div class="mb-3">
                    <label for="pageSize" class="form-label">Page Size:</label>
                    <input type="number" class="form-control" id="pageSize" name="pageSize" value="4" min="1" max="20">
                </div>
                <button type="submit" class="btn btn-primary">Test LoadMoreRecipes</button>
            </form>
        </div>
        
        <div class="col-md-6">
            <h3>Test LoadMoreRecipes (Debug)</h3>
            <form method="get" action="@Url.Action("TestLoadMoreRecipes", "Home")">
                <div class="mb-3">
                    <label for="testPage" class="form-label">Page:</label>
                    <input type="number" class="form-control" id="testPage" name="page" value="1" min="1">
                </div>
                <div class="mb-3">
                    <label for="testPageSize" class="form-label">Page Size:</label>
                    <input type="number" class="form-control" id="testPageSize" name="pageSize" value="4" min="1" max="20">
                </div>
                <button type="submit" class="btn btn-success">Test Debug Version</button>
            </form>
            
            <hr>
            
            <h4>Quick Tests</h4>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-primary btn-sm" onclick="testPage(1)">Page 1</button>
                <button class="btn btn-outline-primary btn-sm" onclick="testPage(2)">Page 2</button>
                <button class="btn btn-outline-primary btn-sm" onclick="testPage(3)">Page 3</button>
                <button class="btn btn-outline-primary btn-sm" onclick="testPage(4)">Page 4</button>
            </div>
            
            <hr>
            
            <h4>Test Simple Counts</h4>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-success btn-sm" onclick="testSimpleCounts(1)">Recipe 1</button>
                <button class="btn btn-outline-success btn-sm" onclick="testSimpleCounts(2)">Recipe 2</button>
                <button class="btn btn-outline-success btn-sm" onclick="testSimpleCounts(3)">Recipe 3</button>
                <button class="btn btn-outline-success btn-sm" onclick="testSimpleCounts(4)">Recipe 4</button>
            </div>
            
            <hr>
            
            <h4>Test Load More Direct</h4>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-warning btn-sm" onclick="testLoadMoreDirect(1)">Page 1 Direct</button>
                <button class="btn btn-outline-warning btn-sm" onclick="testLoadMoreDirect(2)">Page 2 Direct</button>
                <button class="btn btn-outline-warning btn-sm" onclick="testLoadMoreDirect(3)">Page 3 Direct</button>
            </div>
            
            <hr>
            
            <h4>Test Counts Issue</h4>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-danger btn-sm" onclick="testCountsIssue()">Test Counts Issue</button>
                <button class="btn btn-outline-danger btn-sm" onclick="testNewsfeedIssue()">Test Newsfeed Issue</button>
            </div>
            
            <hr>
            
            <h4>Test Load More Counts</h4>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-info btn-sm" onclick="testLoadMoreCounts(1)">Page 1 Counts</button>
                <button class="btn btn-outline-info btn-sm" onclick="testLoadMoreCounts(2)">Page 2 Counts</button>
                <button class="btn btn-outline-info btn-sm" onclick="testLoadMoreCounts(3)">Page 3 Counts</button>
            </div>
            
            <hr>
            
            <h4>Test Original Load More</h4>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-secondary btn-sm" onclick="testOriginalLoadMore(1)">Page 1 Original</button>
                <button class="btn btn-outline-secondary btn-sm" onclick="testOriginalLoadMore(2)">Page 2 Original</button>
                <button class="btn btn-outline-secondary btn-sm" onclick="testOriginalLoadMore(3)">Page 3 Original</button>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h3>Instructions:</h3>
        <ol>
            <li><strong>Test LoadMoreRecipes (Original):</strong> Test API gốc để xem có trả về counts không</li>
            <li><strong>Test LoadMoreRecipes (Debug):</strong> Test API debug với console logging chi tiết</li>
            <li><strong>Quick Tests:</strong> Test nhanh các page khác nhau</li>
        </ol>
        
        <div class="alert alert-info">
            <h5>What to look for:</h5>
            <ul>
                <li><strong>LikesCount:</strong> Should show actual like counts from database</li>
                <li><strong>CommentsCount:</strong> Should show actual comment counts from database</li>
                <li><strong>SharesCount:</strong> Should show actual share counts from database</li>
                <li><strong>Console logs:</strong> Check browser console for detailed debug info</li>
            </ul>
        </div>
    </div>

    @if (ViewBag.TestResult != null)
    {
        <div class="mt-4">
            <h3>Test Result:</h3>
            <div class="alert alert-info">
                <pre><code>@ViewBag.TestResult</code></pre>
            </div>
        </div>
    }
</div>

<script>
    // Quick test function
    function testPage(page) {
        window.open(`/Home/TestLoadMoreRecipes?page=${page}&pageSize=4`, '_blank');
    }
    
    // Test simple counts function
    function testSimpleCounts(recipeId) {
        window.open(`/Home/TestSimpleCounts?recipeId=${recipeId}`, '_blank');
    }
    
    // Test load more direct function
    function testLoadMoreDirect(page) {
        window.open(`/Home/TestLoadMoreDirect?page=${page}&pageSize=4`, '_blank');
    }
    
    // Test counts issue function
    function testCountsIssue() {
        window.open(`/Home/TestCountsIssue`, '_blank');
    }
    
    // Test newsfeed issue function
    function testNewsfeedIssue() {
        window.open(`/Home/TestNewsfeedIssue`, '_blank');
    }
    
    // Test load more counts function
    function testLoadMoreCounts(page) {
        window.open(`/Home/TestLoadMoreCounts?page=${page}&pageSize=4`, '_blank');
    }
    
    // Test original load more function
    function testOriginalLoadMore(page) {
        window.open(`/Home/TestOriginalLoadMore?page=${page}&pageSize=4`, '_blank');
    }
</script>
