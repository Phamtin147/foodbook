@model List<dynamic>
@{
    ViewData["Title"] = "Kiểm duyệt nội dung";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Kiểm duyệt nội dung</h1>
    </div>

    <!-- Search and Filter -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" placeholder="Tìm kiếm" id="searchInput">
            </div>
        </div>
        <div class="col-md-6">
            <div class="d-flex gap-2">
                <select class="form-select" style="width: auto;">
                    <option>Ngày đăng kí (Mới nhất)</option>
                    <option>Ngày đăng kí (Cũ nhất)</option>
                    <option>Tên A-Z</option>
                    <option>Tên Z-A</option>
                </select>
                <button class="btn btn-outline-secondary">
                    <i class="fas fa-filter"></i> Lọc
                </button>
            </div>
        </div>
    </div>

    <!-- Content Table -->
    <div class="card shadow">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Content ID</th>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Flags</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>R@(item.RecipeId?.ToString("D3"))</td>
                                <td>@item.Title</td>
                                <td>@item.Author</td>
                                <td>
                                    <span class="badge bg-@(item.Status == "Approved" ? "success" : "danger")">
                                        @item.Status
                                    </span>
                                </td>
                                <td>@item.Date.ToString("yyyy-MM-dd")</td>
                                <td>
                                    @if (item.ReportCount > 0)
                                    {
                                        <span class="badge bg-danger">
                                            <i class="fas fa-flag"></i> @item.ReportCount
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">0</span>
                                    }
                                </td>
                                <td>
                                    <!-- Nút trắng - Xem chi tiết công thức -->
                                    <a href="@Url.Action("ViewRecipeDetails", "Admin", new { recipeId = item.RecipeId })" 
                                       class="btn btn-sm btn-outline-primary" title="Xem chi tiết công thức">
                                        <i class="fas fa-eye"></i>
                                    </a>

                                    <!-- Nút đỏ - Cắm cờ bài viết -->
                                    <form method="post" action="@Url.Action("FlagRecipe", "Admin")" style="display: inline;">
                                        <input type="hidden" name="recipeId" value="@item.RecipeId" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Cắm cờ bài viết">
                                            <i class="fas fa-flag"></i>
                                        </button>
                                    </form>

                                    <!-- Checkbox - Đánh dấu đã xử lý report -->
                                    @if (item.ReportCount > 0)
                                    {
                                        <form method="post" action="@Url.Action("MarkReportProcessed", "Admin")" style="display: inline;">
                                            <input type="hidden" name="recipeId" value="@item.RecipeId" />
                                            <input type="hidden" name="userId" value="@item.User?.user_id" />
                                            <button type="submit" class="btn btn-sm btn-outline-success" title="Đánh dấu đã xử lý">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </form>
                                    }

                                    <!-- Nút đen - Xem chi tiết report -->
                                    @if (item.ReportCount > 0)
                                    {
                                        <a href="@Url.Action("ViewReportDetails", "Admin", new { recipeId = item.RecipeId })" 
                                           class="btn btn-sm btn-dark" title="Xem chi tiết báo cáo">
                                            <i class="fas fa-bars"></i>
                                        </a>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
.sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 100;
    padding: 48px 0 0;
    box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
}

.sidebar .nav-link {
    font-weight: 500;
    color: #333;
}

.sidebar .nav-link.active {
    color: #007bff;
}

.sidebar .nav-link:hover {
    color: #007bff;
}

.sidebar-heading {
    font-size: .75rem;
    text-transform: uppercase;
}

/* Custom button styles */
.btn-outline-primary {
    border-color: #6c757d;
    color: #6c757d;
}

.btn-outline-primary:hover {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
}

.btn-outline-danger {
    border-color: #dc3545;
    color: #dc3545;
}

.btn-outline-danger:hover {
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
}

.btn-outline-success {
    border-color: #28a745;
    color: #28a745;
}

.btn-outline-success:hover {
    background-color: #28a745;
    border-color: #28a745;
    color: white;
}

.btn-dark {
    background-color: #343a40;
    border-color: #343a40;
}

.btn-dark:hover {
    background-color: #23272b;
    border-color: #1d2124;
}
</style>

<script>
// Search functionality
document.getElementById('searchInput').addEventListener('keyup', function() {
    const searchTerm = this.value.toLowerCase();
    const tableRows = document.querySelectorAll('tbody tr');
    
    tableRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});
</script>